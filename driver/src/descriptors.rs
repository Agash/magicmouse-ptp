#![allow(dead_code)]

// Valid Hybrid Report Descriptor:
// TLC 1: Mouse (Report ID 1)
// TLC 2: PTP (Report ID 2) - 5 Fingers Parallel

pub const HID_REPORT_DESCRIPTOR: &[u8] = &[
    // --- Mouse TLC (Report ID 1) ---
    0x05, 0x01,        // Usage Page (Generic Desktop)
    0x09, 0x02,        // Usage (Mouse)
    0xA1, 0x01,        // Collection (Application)
    0x85, 0x01,        //   Report ID (1)
    0x09, 0x01,        //   Usage (Pointer)
    0xA1, 0x00,        //   Collection (Physical)
    0x05, 0x09,        //     Usage Page (Buttons)
    0x19, 0x01,        //     Usage Min (1)
    0x29, 0x03,        //     Usage Max (3)
    0x15, 0x00,        //     Logical Min (0)
    0x25, 0x01,        //     Logical Max (1)
    0x95, 0x03,        //     Report Count (3)
    0x75, 0x01,        //     Report Size (1)
    0x81, 0x02,        //     Input (Data, Var, Abs)
    0x95, 0x01,        //     Report Count (1) - Padding
    0x75, 0x05,        //     Report Size (5)
    0x81, 0x03,        //     Input (Const)
    0x05, 0x01,        //     Usage Page (Generic Desktop)
    0x09, 0x30,        //     Usage (X)
    0x09, 0x31,        //     Usage (Y)
    0x16, 0x01, 0x80,  //     Logical Min (-32767)
    0x26, 0xFF, 0x7F,  //     Logical Max (32767)
    0x75, 0x10,        //     Report Size (16)
    0x95, 0x02,        //     Report Count (2)
    0x81, 0x06,        //     Input (Data, Var, Rel)
    0xC0,              //   End Collection
    0xC0,              // End Collection

    // --- PTP TLC (Report ID 2) ---
    0x05, 0x0D,        // Usage Page (Digitizer)
    0x09, 0x05,        // Usage (Touch Pad)
    0xA1, 0x01,        // Collection (Application)
    0x85, 0x02,        //   Report ID (2)
    
    // Contact Count (Global)
    0x09, 0x54,        //   Usage (Contact Count)
    0x15, 0x00,        //   Logical Min (0)
    0x25, 0x05,        //   Logical Max (5)
    0x75, 0x08,        //   Report Size (8)
    0x95, 0x01,        //   Report Count (1)
    0x81, 0x02,        //   Input (Data, Var, Abs)

    // Finger 0
    0x09, 0x22,        //   Usage (Finger)
    0xA1, 0x02,        //   Collection (Logical)
    0x09, 0x42,        //     Usage (Tip Switch)
    0x15, 0x00,        //     Logical Min (0)
    0x25, 0x01,        //     Logical Max (1)
    0x75, 0x01,        //     Report Size (1)
    0x95, 0x01,        //     Report Count (1)
    0x81, 0x02,        //     Input (Var)
    0x09, 0x32,        //     Usage (In Range)
    0x81, 0x02,        //     Input (Var)
    0x09, 0x47,        //     Usage (Confidence)
    0x81, 0x02,        //     Input (Var)
    0x95, 0x05,        //     Report Count (5) - Padding
    0x81, 0x03,        //     Input (Cnst)
    0x09, 0x51,        //     Usage (Contact ID)
    0x75, 0x08,        //     Report Size (8)
    0x95, 0x01,        //     Report Count (1)
    0x81, 0x02,        //     Input (Var)
    0x05, 0x01,        //     Usage Page (Generic Desktop)
    0x09, 0x30,        //     Usage (X)
    0x75, 0x10,        //     Report Size (16)
    0x55, 0x0E,        //     Unit Exp (-2)
    0x65, 0x11,        //     Unit (SI Lin, cm)
    0x35, 0x00,        //     Phys Min (0)
    0x46, 0x10, 0x27,  //     Phys Max (10000)
    0x26, 0x10, 0x27,  //     Log Max (10000)
    0x81, 0x02,        //     Input (Var)
    0x09, 0x31,        //     Usage (Y)
    0x46, 0x10, 0x27,  //     Phys Max (10000)
    0x26, 0x10, 0x27,  //     Log Max (10000)
    0x81, 0x02,        //     Input (Var)
    0xC0,              //   End Collection

    // Finger 1 (Same as Finger 0)
    0x05, 0x0D, 0x09, 0x22, 0xA1, 0x02, 0x09, 0x42, 0x15, 0x00, 0x25, 0x01, 0x75, 0x01, 0x95, 0x01,
    0x81, 0x02, 0x09, 0x32, 0x81, 0x02, 0x09, 0x47, 0x81, 0x02, 0x95, 0x05, 0x81, 0x03, 0x09, 0x51,
    0x75, 0x08, 0x95, 0x01, 0x81, 0x02, 0x05, 0x01, 0x09, 0x30, 0x75, 0x10, 0x55, 0x0E, 0x65, 0x11,
    0x35, 0x00, 0x46, 0x10, 0x27, 0x26, 0x10, 0x27, 0x81, 0x02, 0x09, 0x31, 0x46, 0x10, 0x27, 0x26,
    0x10, 0x27, 0x81, 0x02, 0xC0,

    // Finger 2
    0x05, 0x0D, 0x09, 0x22, 0xA1, 0x02, 0x09, 0x42, 0x15, 0x00, 0x25, 0x01, 0x75, 0x01, 0x95, 0x01,
    0x81, 0x02, 0x09, 0x32, 0x81, 0x02, 0x09, 0x47, 0x81, 0x02, 0x95, 0x05, 0x81, 0x03, 0x09, 0x51,
    0x75, 0x08, 0x95, 0x01, 0x81, 0x02, 0x05, 0x01, 0x09, 0x30, 0x75, 0x10, 0x55, 0x0E, 0x65, 0x11,
    0x35, 0x00, 0x46, 0x10, 0x27, 0x26, 0x10, 0x27, 0x81, 0x02, 0x09, 0x31, 0x46, 0x10, 0x27, 0x26,
    0x10, 0x27, 0x81, 0x02, 0xC0,

    // Finger 3
    0x05, 0x0D, 0x09, 0x22, 0xA1, 0x02, 0x09, 0x42, 0x15, 0x00, 0x25, 0x01, 0x75, 0x01, 0x95, 0x01,
    0x81, 0x02, 0x09, 0x32, 0x81, 0x02, 0x09, 0x47, 0x81, 0x02, 0x95, 0x05, 0x81, 0x03, 0x09, 0x51,
    0x75, 0x08, 0x95, 0x01, 0x81, 0x02, 0x05, 0x01, 0x09, 0x30, 0x75, 0x10, 0x55, 0x0E, 0x65, 0x11,
    0x35, 0x00, 0x46, 0x10, 0x27, 0x26, 0x10, 0x27, 0x81, 0x02, 0x09, 0x31, 0x46, 0x10, 0x27, 0x26,
    0x10, 0x27, 0x81, 0x02, 0xC0,

    // Finger 4
    0x05, 0x0D, 0x09, 0x22, 0xA1, 0x02, 0x09, 0x42, 0x15, 0x00, 0x25, 0x01, 0x75, 0x01, 0x95, 0x01,
    0x81, 0x02, 0x09, 0x32, 0x81, 0x02, 0x09, 0x47, 0x81, 0x02, 0x95, 0x05, 0x81, 0x03, 0x09, 0x51,
    0x75, 0x08, 0x95, 0x01, 0x81, 0x02, 0x05, 0x01, 0x09, 0x30, 0x75, 0x10, 0x55, 0x0E, 0x65, 0x11,
    0x35, 0x00, 0x46, 0x10, 0x27, 0x26, 0x10, 0x27, 0x81, 0x02, 0x09, 0x31, 0x46, 0x10, 0x27, 0x26,
    0x10, 0x27, 0x81, 0x02, 0xC0,

    // Scan Time
    0x05, 0x0D,        //   Usage Page (Digitizer)
    0x09, 0x56,        //   Usage (Scan Time)
    0x75, 0x10,        //   Report Size (16)
    0x95, 0x01,        //   Report Count (1)
    0x81, 0x02,        //   Input (Var)
    
    // Feature Report (Device Configuration)
    0x05, 0x0D,        // Usage Page (Digitizer)
    0x09, 0x0E,        // Usage (Device Configuration)
    0xA1, 0x01,        // Collection (Application) - Optional inner, often just fields
    0x85, 0x03,        //   Report ID (3) - Feature Report
    0x09, 0x23,        //   Usage (Device Settings)
    0xA1, 0x02,        //   Collection (Logical)
    0x09, 0x52,        //     Usage (Input Mode)
    0x15, 0x00,        //     Logical Min (0)
    0x25, 0x03,        //     Logical Max (3) - 0:Mouse, 3:PTP
    0x75, 0x08,        //     Report Size (8)
    0x95, 0x01,        //     Report Count (1)
    0xB1, 0x02,        //     Feature (Var)

    0xC0,              //   End Collection
];

// Raw Hardware Report (From Bluetooth)
#[repr(C, packed)]
#[derive(Debug, Clone, Copy)]
pub struct MagicMouseInputReport {
    pub report_id: u8,      // 0x10
    pub buttons: u8,
    pub dx: i16,
    pub dy: i16,
    pub touch_data: [u8; 56], // Raw Touch Data (up to ~7 fingers, but we use 5)
}
impl MagicMouseInputReport {
    pub const REPORT_ID: u8 = 0x10;
}

// OS Input Report 1: Mouse
#[repr(C, packed)]
#[derive(Clone, Copy, Debug, Default)]
pub struct MouseInputReport {
    pub report_id: u8,
    pub buttons: u8,
    pub x: i16,
    pub y: i16,
    // Padding to match Report descriptor if needed, or wheel
}

// OS Input Report 2: PTP (Windows Precision Touchpad)
#[repr(C, packed)]
#[derive(Clone, Copy, Debug, Default)]
pub struct PTPContact {
    pub status: u8,      // Tip(1), InRange(1), Conf(1), Padding(5)
    pub contact_id: u8,
    pub x: u16,
    pub y: u16,
}

#[repr(C, packed)]
#[derive(Clone, Copy, Debug, Default)]
pub struct PTPInputReport {
    pub report_id: u8,       // 0x02
    pub contact_count: u8,
    pub contacts: [PTPContact; 5],
    pub scan_time: u16,
}

#[repr(C, packed)]
#[derive(Clone, Copy, Debug, Default)]
pub struct PTPFeatureReport {
    pub report_id: u8,   // 0x03
    pub input_mode: u8,  // 0x00 = Mouse, 0x03 = PTP
}

impl PTPFeatureReport {
    pub const REPORT_ID: u8 = 0x03;
    pub const MODE_MOUSE: u8 = 0x00;
    pub const MODE_PTP: u8 = 0x03;
}